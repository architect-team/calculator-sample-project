{
    "resource": {
        "kubernetes_deployment": {
            "addition-service": {
                "depends_on": [],
                "metadata": {
                    "labels": {
                        "app": "addition-service"
                    },
                    "name": "addition-service",
                    "namespace": "${var.namespace}"
                },
                "spec": [
                    {
                        "replicas": "${var.addition-service-replicas}",
                        "selector": {
                            "match_labels": {
                                "app": "addition-service"
                            }
                        },
                        "template": {
                            "metadata": {
                                "labels": {
                                    "app": "addition-service"
                                }
                            },
                            "spec": [
                                {
                                    "container": {
                                        "env": [],
                                        "image": "615038130497.dkr.ecr.us-east-1.amazonaws.com/architect-addition-service:${var.addition-service-image-tag}",
                                        "name": "addition-service"
                                    },
                                    "image_pull_secrets": [
                                        {
                                            "name": "${var.default-image-pull-secret-name}"
                                        }
                                    ]
                                }
                            ]
                        }
                    }
                ]
            },
            "division-service": {
                "depends_on": [],
                "metadata": {
                    "labels": {
                        "app": "division-service"
                    },
                    "name": "division-service",
                    "namespace": "${var.namespace}"
                },
                "spec": [
                    {
                        "replicas": "${var.division-service-replicas}",
                        "selector": {
                            "match_labels": {
                                "app": "division-service"
                            }
                        },
                        "template": {
                            "metadata": {
                                "labels": {
                                    "app": "division-service"
                                }
                            },
                            "spec": [
                                {
                                    "container": {
                                        "env": [
                                            {
                                                "name": "ARCHITECT_SUBTRACTION_SERVICE",
                                                "value": "{\"host\": \"${kubernetes_service.subtraction-service.spec.0.cluster_ip}\", \"port\": \"${var.subtraction-service-expose-port}\", \"proto_prefix\": \"service\"}"
                                            }
                                        ],
                                        "image": "615038130497.dkr.ecr.us-east-1.amazonaws.com/architect-division-service:${var.division-service-image-tag}",
                                        "name": "division-service"
                                    },
                                    "image_pull_secrets": [
                                        {
                                            "name": "${var.default-image-pull-secret-name}"
                                        }
                                    ]
                                }
                            ]
                        }
                    }
                ]
            },
            "subtraction-service": {
                "depends_on": [],
                "metadata": {
                    "labels": {
                        "app": "subtraction-service"
                    },
                    "name": "subtraction-service",
                    "namespace": "${var.namespace}"
                },
                "spec": [
                    {
                        "replicas": "${var.subtraction-service-replicas}",
                        "selector": {
                            "match_labels": {
                                "app": "subtraction-service"
                            }
                        },
                        "template": {
                            "metadata": {
                                "labels": {
                                    "app": "subtraction-service"
                                }
                            },
                            "spec": [
                                {
                                    "container": {
                                        "env": [
                                            {
                                                "name": "ARCHITECT_ADDITION_SERVICE",
                                                "value": "{\"host\": \"${kubernetes_service.addition-service.spec.0.cluster_ip}\", \"port\": \"${var.addition-service-expose-port}\", \"proto_prefix\": \"service\"}"
                                            }
                                        ],
                                        "image": "615038130497.dkr.ecr.us-east-1.amazonaws.com/architect-subtraction-service:${var.subtraction-service-image-tag}",
                                        "name": "subtraction-service"
                                    },
                                    "image_pull_secrets": [
                                        {
                                            "name": "${var.default-image-pull-secret-name}"
                                        }
                                    ]
                                }
                            ]
                        }
                    }
                ]
            },
            "test-service": {
                "depends_on": [],
                "metadata": {
                    "labels": {
                        "app": "test-service"
                    },
                    "name": "test-service",
                    "namespace": "${var.namespace}"
                },
                "spec": [
                    {
                        "replicas": "${var.test-service-replicas}",
                        "selector": {
                            "match_labels": {
                                "app": "test-service"
                            }
                        },
                        "template": {
                            "metadata": {
                                "labels": {
                                    "app": "test-service"
                                }
                            },
                            "spec": [
                                {
                                    "container": {
                                        "env": [
                                            {
                                                "name": "ARCHITECT_DIVISION_SERVICE",
                                                "value": "{\"host\": \"${kubernetes_service.division-service.spec.0.cluster_ip}\", \"port\": \"${var.division-service-expose-port}\", \"proto_prefix\": \"service\"}"
                                            }
                                        ],
                                        "image": "615038130497.dkr.ecr.us-east-1.amazonaws.com/architect-test-service:${var.test-service-image-tag}",
                                        "name": "test-service"
                                    },
                                    "image_pull_secrets": [
                                        {
                                            "name": "${var.default-image-pull-secret-name}"
                                        }
                                    ]
                                }
                            ]
                        }
                    }
                ]
            }
        },
        "kubernetes_service": {
            "addition-service": {
                "depends_on": [],
                "metadata": {
                    "name": "addition-service",
                    "namespace": "${var.namespace}"
                },
                "spec": {
                    "port": {
                        "port": "${var.addition-service-expose-port}",
                        "target_port": "8080"
                    },
                    "selector": {
                        "app": "addition-service"
                    },
                    "type": "ClusterIP"
                }
            },
            "division-service": {
                "depends_on": [],
                "metadata": {
                    "name": "division-service",
                    "namespace": "${var.namespace}"
                },
                "spec": {
                    "port": {
                        "port": "${var.division-service-expose-port}",
                        "target_port": "8080"
                    },
                    "selector": {
                        "app": "division-service"
                    },
                    "type": "ClusterIP"
                }
            },
            "subtraction-service": {
                "depends_on": [],
                "metadata": {
                    "name": "subtraction-service",
                    "namespace": "${var.namespace}"
                },
                "spec": {
                    "port": {
                        "port": "${var.subtraction-service-expose-port}",
                        "target_port": "8080"
                    },
                    "selector": {
                        "app": "subtraction-service"
                    },
                    "type": "ClusterIP"
                }
            },
            "test-service": {
                "depends_on": [],
                "metadata": {
                    "name": "test-service",
                    "namespace": "${var.namespace}"
                },
                "spec": {
                    "port": {
                        "port": "${var.test-service-expose-port}",
                        "target_port": "8080"
                    },
                    "selector": {
                        "app": "test-service"
                    },
                    "type": "LoadBalancer"
                }
            }
        }
    },
    "terraform": {
        "required_version": ">= 0.11.0"
    },
    "variable": {
        "addition-service-expose-port": {
            "default": "80",
            "description": "Port to expose the service on",
            "type": "string"
        },
        "addition-service-image-tag": {
            "default": "latest",
            "description": "Tag of the service docker image to use in the environment",
            "type": "string"
        },
        "addition-service-replicas": {
            "default": 1,
            "description": "Number of instances to run in the cluster",
            "type": "string"
        },
        "default-image-pull-secret-name": {
            "default": "",
            "description": "Name of the kubernetes secret to be used by default to pull containers",
            "type": "string"
        },
        "division-service-expose-port": {
            "default": "80",
            "description": "Port to expose the service on",
            "type": "string"
        },
        "division-service-image-tag": {
            "default": "latest",
            "description": "Tag of the service docker image to use in the environment",
            "type": "string"
        },
        "division-service-replicas": {
            "default": 1,
            "description": "Number of instances to run in the cluster",
            "type": "string"
        },
        "namespace": {
            "description": "Name of an existing namespace to put resources into",
            "type": "string"
        },
        "subtraction-service-expose-port": {
            "default": "80",
            "description": "Port to expose the service on",
            "type": "string"
        },
        "subtraction-service-image-tag": {
            "default": "latest",
            "description": "Tag of the service docker image to use in the environment",
            "type": "string"
        },
        "subtraction-service-replicas": {
            "default": 1,
            "description": "Number of instances to run in the cluster",
            "type": "string"
        },
        "test-service-expose-port": {
            "default": "80",
            "description": "Port to expose the service on",
            "type": "string"
        },
        "test-service-image-tag": {
            "default": "latest",
            "description": "Tag of the service docker image to use in the environment",
            "type": "string"
        },
        "test-service-replicas": {
            "default": 1,
            "description": "Number of instances to run in the cluster",
            "type": "string"
        }
    }
}